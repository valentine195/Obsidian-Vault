/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __publicField = (obj, key, value) => {
  __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
  return value;
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MarkdownAttributes
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/processor.ts
var _Processor = class {
  constructor() {
  }
  static parse(el) {
    if (typeof el == "string") {
      return new _Processor().parseLine(el);
    } else {
      return new _Processor().recurseAndParseElements(el);
    }
  }
  parseLine(text) {
    const elements = [];
    let attribute_strings = text.matchAll(
      new RegExp(_Processor.END_RE.source, "gm")
    );
    for (const [_, match] of attribute_strings) {
      elements.push({
        attributes: this.getAttrs(match),
        text: match
      });
    }
    return elements;
  }
  getTopLevelText(el) {
    const texts = [];
    for (let child of Array.from(el.childNodes)) {
      if (child.nodeType == Node.TEXT_NODE) {
        texts.push(child.data);
      }
    }
    return texts.join("");
  }
  getAttrs(str) {
    const trys = (str != null ? str : "").split(/\s(?=(?:[^'"`]*(['"`])[^'"`]*\1)*[^'"`]*$)/).map((t) => t && t.trim()).filter((t) => t && t !== '"' && t !== "'" && t.length);
    if (!trys || !trys.length)
      return;
    const allowedKeyChars = /[^\t\n\f />"'=]/;
    const keySeparator = "=";
    const classChar = ".";
    const attrs = [];
    for (let pair of trys) {
      if (!pair || !pair.length)
        continue;
      if (pair.charAt(0) === classChar) {
        attrs.push(["class", pair.slice(1)]);
        continue;
      }
      if (new RegExp(keySeparator).test(pair) && allowedKeyChars.test(pair.slice(0, pair.indexOf(keySeparator)))) {
        attrs.push([...pair.split(keySeparator, 2)]);
        continue;
      }
      attrs.push([pair, null]);
    }
    return attrs;
  }
  recurseAndParseElements(el) {
    var _a, _b, _c;
    const elements = [];
    const text = this.getTopLevelText(el);
    if (_Processor.BLOCK_RE.test(text)) {
      let element = el;
      if (el instanceof HTMLLIElement || (el == null ? void 0 : el.parentElement) instanceof HTMLQuoteElement || (el == null ? void 0 : el.hasClass("callout"))) {
        element = el.parentElement;
      }
      let [original, attribute_string] = (_a = text.match(_Processor.BLOCK_RE)) != null ? _a : [];
      const toAdd = {
        element,
        attributes: this.getAttrs(attribute_string),
        text: attribute_string
      };
      elements.push(toAdd);
      el.innerHTML = this.tryToReplace(
        toAdd.element,
        el.innerHTML,
        toAdd.attributes,
        original
      );
      if (el instanceof HTMLLIElement) {
        elements.push(...this.recurseAndParseElements(el));
      }
    } else if (_Processor.BASE_RE.test(text)) {
      let textNode = Array.from(el.childNodes).find(
        (node) => node.nodeType == Node.TEXT_NODE && _Processor.BASE_RE.test(text)
      );
      let sibling = (_b = Array.from(el.children).find(
        (node) => node.nextSibling == textNode
      )) != null ? _b : el;
      if (sibling && sibling.hasClass("collapse-indicator")) {
        sibling = sibling.parentElement;
      }
      if (sibling && sibling instanceof HTMLBRElement) {
        sibling = sibling.parentElement;
      }
      let [original, attribute_string] = (_c = text.match(_Processor.BASE_RE)) != null ? _c : [];
      const toAdd = {
        element: sibling,
        attributes: this.getAttrs(attribute_string),
        text: attribute_string
      };
      elements.push(toAdd);
      textNode.textContent = this.tryToReplace(
        toAdd.element,
        textNode.textContent,
        toAdd.attributes,
        original
      );
    }
    for (let child of Array.from(el.children)) {
      if (!(child instanceof HTMLElement))
        continue;
      if (child instanceof HTMLPreElement || child.tagName.toLowerCase() === "code")
        continue;
      elements.push(...this.recurseAndParseElements(child));
    }
    return elements;
  }
  tryToReplace(element, content, attributes, original) {
    if (!attributes || !attributes.length) {
      return content;
    }
    for (let [key, value] of attributes) {
      if (!key)
        continue;
      if (value)
        value = value.replace(/("|')/g, "");
      try {
        if (key === "class") {
          element.addClasses(value.split(" "));
        } else if (!value) {
          element.setAttr(key, true);
        } else {
          element.setAttr(key, value);
        }
      } catch (e) {
        console.log(
          `Markdown Attributes: ${key} is not a valid attribute.`
        );
        return content;
      }
    }
    return content.replace(original, "");
  }
};
var Processor = _Processor;
__publicField(Processor, "BASE_RE", /\{\:?[ ]*([^\}\n ][^\}\n]*)[ ]*\}/);
__publicField(Processor, "ONLY_RE", /^\{\:?[ ]*([^\}\n ][^\}\n]*)[ ]*\}$/);
__publicField(Processor, "BLOCK_RE", /\n[ ]*\{\:?[ ]*([^\}\n ][^\}\n]*)[ ]*\}[ ]*$/);
__publicField(Processor, "END_RE", /\{\:?[ ]*([^\}\n ][^\}\n]*)[ ]*\}$/m);

// src/live-preview.ts
var import_view = require("@codemirror/view");
var import_language = require("@codemirror/language");
var import_obsidian = require("obsidian");
function selectionAndRangeOverlap(selection, rangeFrom, rangeTo) {
  for (const range of selection.ranges) {
    if (range.from <= rangeTo && range.to >= rangeFrom) {
      return true;
    }
  }
  return false;
}
var InlineWidget = class extends import_view.WidgetType {
  constructor(cssClasses, rawQuery, el, view) {
    super();
    this.cssClasses = cssClasses;
    this.rawQuery = rawQuery;
    this.el = el;
    this.view = view;
  }
  eq(other) {
    if (other.rawQuery === this.rawQuery) {
      for (let value of other.cssClasses) {
        if (!this.cssClasses.includes(value)) {
          this.el.removeClass(value);
        } else {
          this.el.addClass(value);
        }
      }
      return true;
    }
    return false;
  }
  toDOM(view) {
    this.el.addClasses(this.cssClasses);
    return this.el;
  }
  ignoreEvent(event) {
    if (event.type === "mousedown") {
      const currentPos = this.view.posAtCoords({
        x: event.x,
        y: event.y
      });
      if (event.shiftKey) {
        if (currentPos) {
          const { editor } = this.view.state.field(import_obsidian.editorEditorField).state.field(import_obsidian.editorViewField);
          editor.setCursor(editor.offsetToPos(currentPos));
        }
        return false;
      }
    }
    return true;
  }
};
function getCssClasses(nodeName) {
  const classes = [];
  if (nodeName.includes("strong")) {
    classes.push("cm-strong");
  }
  if (nodeName.includes("em")) {
    classes.push("cm-em");
  }
  if (nodeName.includes("highlight")) {
    classes.push("cm-highlight");
  }
  if (nodeName.includes("strikethrough")) {
    classes.push("cm-strikethrough");
  }
  if (nodeName.includes("comment")) {
    classes.push("cm-comment");
  }
  return classes;
}
function inlineRender(view) {
  const currentFile = app.workspace.getActiveFile();
  if (!currentFile)
    return;
  const widgets = [];
  const selection = view.state.selection;
  for (const { from, to } of view.visibleRanges) {
    (0, import_language.syntaxTree)(view.state).iterate({
      from,
      to,
      enter: ({ node }) => {
        var _a;
        const type = node.type;
        if (type.name.includes("formatting"))
          return;
        const start = node.from;
        const end = node.to;
        if (selectionAndRangeOverlap(selection, start - 1, end + 1))
          return;
        const original = view.state.doc.sliceString(start, end);
        if (!Processor.END_RE.test(original))
          return;
        let code = "";
        const el = createSpan({
          cls: ["dataview", "dataview-inline"]
        });
        code = original.trim();
        const parsed = (_a = Processor.parse(original)) != null ? _a : [];
        console.log(
          "\u{1F680} ~ file: live-preview.ts ~ line 191 ~ parsed",
          parsed
        );
        for (const item of parsed) {
          const { attributes, text } = item;
          const firstBracket = original.slice(0, original.indexOf(text)).lastIndexOf("{");
          const lastBracket = original.indexOf(
            "}",
            original.indexOf(text)
          );
          const classes = getCssClasses(type.name);
          widgets.push(
            import_view.Decoration.replace({
              widget: new InlineWidget(classes, code, el, view),
              inclusive: false,
              block: false
            }).range(start + firstBracket, start + lastBracket + 1),
            import_view.Decoration.mark({
              inclusive: true,
              attributes: Object.fromEntries(attributes)
            }).range(from, to)
          );
        }
      }
    });
  }
  return import_view.Decoration.set(widgets, true);
}
function inlinePlugin() {
  return import_view.ViewPlugin.fromClass(
    class {
      constructor(view) {
        __publicField(this, "decorations");
        var _a;
        this.decorations = (_a = inlineRender(view)) != null ? _a : import_view.Decoration.none;
      }
      update(update) {
        var _a;
        if (!update.state.field(import_obsidian.editorLivePreviewField)) {
          this.decorations = import_view.Decoration.none;
          return;
        }
        if (update.docChanged || update.viewportChanged || update.selectionSet) {
          this.decorations = (_a = inlineRender(update.view)) != null ? _a : import_view.Decoration.none;
        }
      }
    },
    { decorations: (v) => v.decorations }
  );
}

// src/main.ts
var MarkdownAttributes = class extends import_obsidian2.Plugin {
  constructor() {
    super(...arguments);
    __publicField(this, "parsing", /* @__PURE__ */ new Map());
  }
  onload() {
    return __async(this, null, function* () {
      console.log(`Markdown Attributes v${this.manifest.version} loaded.`);
      this.registerMarkdownPostProcessor(this.postprocessor.bind(this));
      this.registerEditorExtension(inlinePlugin());
    });
  }
  postprocessor(topElement, ctx) {
    return __async(this, null, function* () {
      var _a, _b, _c;
      const child = topElement.firstElementChild;
      if (!child)
        return;
      let str;
      if (child instanceof HTMLPreElement) {
        if (!ctx.getSectionInfo(topElement))
          return;
        const { lineStart } = ctx.getSectionInfo(topElement);
        const file = this.app.vault.getAbstractFileByPath(ctx.sourcePath);
        if (!(file instanceof import_obsidian2.TFile))
          return;
        const text = yield this.app.vault.cachedRead(file);
        let source = text.split("\n").slice(lineStart, lineStart + 1);
        str = source.join("\n");
        if (!Processor.BASE_RE.test(str))
          return;
        let [attribute_string] = (_a = str.match(Processor.BASE_RE)) != null ? _a : [];
        child.prepend(new Text(attribute_string));
      }
      if (child instanceof HTMLTableElement || child.hasClass("math") && child.hasClass("math-block") || child.hasClass("callout")) {
        if (!ctx.getSectionInfo(topElement))
          return;
        const { text, lineEnd } = ctx.getSectionInfo(topElement);
        const adjustment = child.hasClass("callout") ? 0 : 1;
        let source = ((_b = text.split("\n").slice(lineEnd + adjustment, lineEnd + adjustment + 1)) != null ? _b : []).shift();
        if (source && source.length && Processor.ONLY_RE.test(source.trim())) {
          let [attribute_string] = (_c = source.match(Processor.ONLY_RE)) != null ? _c : [];
          child.prepend(new Text(attribute_string));
          str = topElement.innerText;
        }
      }
      if (child instanceof HTMLParagraphElement && !child.childElementCount) {
        if (Processor.ONLY_RE.test(child.innerText.trim())) {
          child.detach();
          return;
        }
      }
      if (!Processor.BASE_RE.test(str != null ? str : topElement.innerText))
        return;
      if (!(child instanceof HTMLElement))
        return;
      Processor.parse(child);
    });
  }
  onunload() {
    return __async(this, null, function* () {
      console.log("Markdown Attributes unloaded");
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vR2l0SHViL29ic2lkaWFuLW1hcmtkb3duLWF0dHJpYnV0ZXMvc3JjL21haW4udHMiLCAiLi4vLi4vLi4vLi4vR2l0SHViL29ic2lkaWFuLW1hcmtkb3duLWF0dHJpYnV0ZXMvc3JjL3Byb2Nlc3Nvci50cyIsICIuLi8uLi8uLi8uLi9HaXRIdWIvb2JzaWRpYW4tbWFya2Rvd24tYXR0cmlidXRlcy9zcmMvbGl2ZS1wcmV2aWV3LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LCBQbHVnaW4sIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmltcG9ydCBQcm9jZXNzb3IgZnJvbSBcIi4vcHJvY2Vzc29yXCI7XG5pbXBvcnQgeyBpbmxpbmVQbHVnaW4gfSBmcm9tIFwiLi9saXZlLXByZXZpZXdcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFya2Rvd25BdHRyaWJ1dGVzIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBwYXJzaW5nOiBNYXA8TWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgc3RyaW5nPiA9IG5ldyBNYXAoKTtcbiAgICBhc3luYyBvbmxvYWQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBNYXJrZG93biBBdHRyaWJ1dGVzIHYke3RoaXMubWFuaWZlc3QudmVyc2lvbn0gbG9hZGVkLmApO1xuXG4gICAgICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93blBvc3RQcm9jZXNzb3IodGhpcy5wb3N0cHJvY2Vzc29yLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKGlubGluZVBsdWdpbigpKTtcbiAgICB9XG5cbiAgICBhc3luYyBwb3N0cHJvY2Vzc29yKFxuICAgICAgICB0b3BFbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgICAgICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0XG4gICAgKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkID0gdG9wRWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZDtcbiAgICAgICAgaWYgKCFjaGlsZCkgcmV0dXJuO1xuICAgICAgICBsZXQgc3RyOiBzdHJpbmc7XG5cbiAgICAgICAgLyoqIENvZGUgYmxvY2tzIGhhdmUgdG8gYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGJlY2F1c2UgT2JzaWRpYW4gZG9lcyBub3RcbiAgICAgICAgICogIGluY2x1ZGUgYW55IHRleHQgcGFzdCB0aGUgbGFuZ3VhZ2UuXG4gICAgICAgICAqXG4gICAgICAgICAqICBVbmZvcnR1bmF0ZWx5IHRoaXMgYWxzbyBtZWFucyB0aGF0IGNoYW5nZXMgdG8gdGhlIGNvZGUgYmxvY2sgYXR0cmlidXRlc1xuICAgICAgICAgKiAgcmVxdWlyZSByZWxvYWRpbmcgdGhlIG5vdGUgdG8gdGFrZSBlZmZlY3QgYmVjYXVzZSB0aGV5IGRvIG5vdCB0cmlnZ2VyIHRoZSBwb3N0cHJvY2Vzc29yLlxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgSFRNTFByZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIC8qKiBJZiBnZXRTZWN0aW9uSW5mbyByZXR1cm5zIG51bGwsIHN0b3AgcHJvY2Vzc2luZy4gKi9cbiAgICAgICAgICAgIGlmICghY3R4LmdldFNlY3Rpb25JbmZvKHRvcEVsZW1lbnQpKSByZXR1cm47XG5cbiAgICAgICAgICAgIC8qKiBQdWxsIHRoZSBTZWN0aW9uIGRhdGEuICovXG4gICAgICAgICAgICBjb25zdCB7IGxpbmVTdGFydCB9ID0gY3R4LmdldFNlY3Rpb25JbmZvKHRvcEVsZW1lbnQpO1xuXG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGN0eC5zb3VyY2VQYXRoKTtcbiAgICAgICAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKGZpbGUpO1xuXG4gICAgICAgICAgICAvKiogR2V0IHRoZSBzb3VyY2UgZm9yIHRoaXMgZWxlbWVudC4gT25seSBsb29rIGF0IHRoZSB0b3AgbGluZSBmb3IgY29kZSBibG9ja3MuICovXG4gICAgICAgICAgICBsZXQgc291cmNlID0gdGV4dC5zcGxpdChcIlxcblwiKS5zbGljZShsaW5lU3RhcnQsIGxpbmVTdGFydCArIDEpO1xuICAgICAgICAgICAgc3RyID0gc291cmNlLmpvaW4oXCJcXG5cIik7XG4gICAgICAgICAgICAvKiogVGVzdCBpZiB0aGUgZWxlbWVudCBjb250YWlucyBhdHRyaWJ1dGVzLiAqL1xuICAgICAgICAgICAgaWYgKCFQcm9jZXNzb3IuQkFTRV9SRS50ZXN0KHN0cikpIHJldHVybjtcblxuICAgICAgICAgICAgLyoqIFB1bGwgdGhlIG1hdGNoZWQgc3RyaW5nIGFuZCBhZGQgaXQgdG8gdGhlIGNoaWxkIHNvIHRoZSBQcm9jZXNzb3IgY2F0Y2hlcyBpdC4gKi9cbiAgICAgICAgICAgIGxldCBbYXR0cmlidXRlX3N0cmluZ10gPSBzdHIubWF0Y2goUHJvY2Vzc29yLkJBU0VfUkUpID8/IFtdO1xuICAgICAgICAgICAgY2hpbGQucHJlcGVuZChuZXcgVGV4dChhdHRyaWJ1dGVfc3RyaW5nKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGFibGUgZWxlbWVudHMgYW5kIE1hdGhqYXggZWxlbWVudHMgc2hvdWxkIGNoZWNrIHRoZSBuZXh0IGxpbmUgaW4gdGhlIHNvdXJjZSB0byBzZWUgaWYgaXQgaXMgYSBzaW5nbGUgYmxvY2sgYXR0cmlidXRlLFxuICAgICAgICAgKiBiZWNhdXNlIHRob3NlIGJsb2NrIGF0dHJpYnV0ZXMgYXJlIG5vdCBhcHBsaWVkIHRvIHRoZSB0YWJsZS5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGNoaWxkIGluc3RhbmNlb2YgSFRNTFRhYmxlRWxlbWVudCB8fFxuICAgICAgICAgICAgKGNoaWxkLmhhc0NsYXNzKFwibWF0aFwiKSAmJiBjaGlsZC5oYXNDbGFzcyhcIm1hdGgtYmxvY2tcIikpIHx8XG4gICAgICAgICAgICBjaGlsZC5oYXNDbGFzcyhcImNhbGxvdXRcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAoIWN0eC5nZXRTZWN0aW9uSW5mbyh0b3BFbGVtZW50KSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAvKiogUHVsbCB0aGUgU2VjdGlvbiBkYXRhLiAqL1xuICAgICAgICAgICAgY29uc3QgeyB0ZXh0LCBsaW5lRW5kIH0gPSBjdHguZ2V0U2VjdGlvbkluZm8odG9wRWxlbWVudCk7XG5cbiAgICAgICAgICAgIC8qKiBDYWxsb3V0cyBpbmNsdWRlIHRoZSBibG9jayBsZXZlbCBhdHRyaWJ1dGUgKi9cbiAgICAgICAgICAgIGNvbnN0IGFkanVzdG1lbnQgPSBjaGlsZC5oYXNDbGFzcyhcImNhbGxvdXRcIikgPyAwIDogMTtcblxuICAgICAgICAgICAgLyoqIEdldCB0aGUgc291cmNlIGZvciB0aGlzIGVsZW1lbnQuICovXG4gICAgICAgICAgICBsZXQgc291cmNlID0gKFxuICAgICAgICAgICAgICAgIHRleHRcbiAgICAgICAgICAgICAgICAgICAgLnNwbGl0KFwiXFxuXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zbGljZShsaW5lRW5kICsgYWRqdXN0bWVudCwgbGluZUVuZCArIGFkanVzdG1lbnQgKyAxKSA/PyBbXVxuICAgICAgICAgICAgKS5zaGlmdCgpO1xuXG4gICAgICAgICAgICAvKiogVGVzdCBpZiB0aGUgZWxlbWVudCBjb250YWlucyBhdHRyaWJ1dGVzLiAqL1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHNvdXJjZSAmJlxuICAgICAgICAgICAgICAgIHNvdXJjZS5sZW5ndGggJiZcbiAgICAgICAgICAgICAgICBQcm9jZXNzb3IuT05MWV9SRS50ZXN0KHNvdXJjZS50cmltKCkpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAvKiogUHVsbCB0aGUgbWF0Y2hlZCBzdHJpbmcgYW5kIGFkZCBpdCB0byB0aGUgY2hpbGQgc28gdGhlIFByb2Nlc3NvciBjYXRjaGVzIGl0LiAqL1xuICAgICAgICAgICAgICAgIGxldCBbYXR0cmlidXRlX3N0cmluZ10gPSBzb3VyY2UubWF0Y2goUHJvY2Vzc29yLk9OTFlfUkUpID8/IFtdO1xuICAgICAgICAgICAgICAgIGNoaWxkLnByZXBlbmQobmV3IFRleHQoYXR0cmlidXRlX3N0cmluZykpO1xuXG4gICAgICAgICAgICAgICAgc3RyID0gdG9wRWxlbWVudC5pbm5lclRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdGhlIGVsZW1lbnQgaXMgYSA8cD4gYW5kIHRoZSB0ZXh0IGlzICpvbmx5KiBhbiBhdHRyaWJ1dGUsIGl0IHdhcyB1c2VkIGFzIGEgYmxvY2sgYXR0cmlidXRlXG4gICAgICAgICAqIGFuZCBzaG91bGQgYmUgcmVtb3ZlZC5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEhUTUxQYXJhZ3JhcGhFbGVtZW50ICYmICFjaGlsZC5jaGlsZEVsZW1lbnRDb3VudCkge1xuICAgICAgICAgICAgaWYgKFByb2Nlc3Nvci5PTkxZX1JFLnRlc3QoY2hpbGQuaW5uZXJUZXh0LnRyaW0oKSkpIHtcbiAgICAgICAgICAgICAgICBjaGlsZC5kZXRhY2goKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiogVGVzdCBpZiB0aGUgZWxlbWVudCBjb250YWlucyBhdHRyaWJ1dGVzLiAqL1xuICAgICAgICBpZiAoIVByb2Nlc3Nvci5CQVNFX1JFLnRlc3Qoc3RyID8/IHRvcEVsZW1lbnQuaW5uZXJUZXh0KSkgcmV0dXJuO1xuXG4gICAgICAgIC8qKiBQYXJzZSB0aGUgZWxlbWVudCB1c2luZyB0aGUgUHJvY2Vzc29yLiAqL1xuICAgICAgICBpZiAoIShjaGlsZCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkgcmV0dXJuO1xuICAgICAgICBQcm9jZXNzb3IucGFyc2UoY2hpbGQpO1xuICAgIH1cblxuICAgIGFzeW5jIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1hcmtkb3duIEF0dHJpYnV0ZXMgdW5sb2FkZWRcIik7XG4gICAgfVxuICAgIC8qICAgICBzdGF0ZSgpIHtcbiAgICAgICAgLy9odHRwczovL2dpc3QuZ2l0aHViLmNvbS9ub3RoaW5naXNsb3N0L2ZhYTg5YWE3MjMyNTQ4ODNkMzdmNDVmZDE2MTYyMzM3XG4gICAgICAgIHR5cGUgVG9rZW5TcGVjID0ge1xuICAgICAgICAgICAgZnJvbTogbnVtYmVyO1xuICAgICAgICAgICAgdG86IG51bWJlcjtcbiAgICAgICAgICAgIGxvYzogeyBmcm9tOiBudW1iZXI7IHRvOiBudW1iZXIgfTtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IFtzdHJpbmcsIHN0cmluZ11bXTtcbiAgICAgICAgICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgICAgICAgICBpbmRleDogbnVtYmVyO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNsYXNzIFN0YXRlZnVsRGVjb3JhdGlvblNldCB7XG4gICAgICAgICAgICBlZGl0b3I6IEVkaXRvclZpZXc7XG4gICAgICAgICAgICByZXBsYWNlcnM6IHsgW2Nsczogc3RyaW5nXTogRGVjb3JhdGlvbiB9ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgIG1hcmtlcnM6IHsgW2Nsczogc3RyaW5nXTogRGVjb3JhdGlvbiB9ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgICAgICAgICAgY29uc3RydWN0b3IoZWRpdG9yOiBFZGl0b3JWaWV3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhc3luYyBjb21wdXRlKHRva2VuczogVG9rZW5TcGVjW10pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXBsYWNlOiBSYW5nZTxEZWNvcmF0aW9uPltdID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgdG9rZW4gb2YgdG9rZW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbmVlZCB0byBhZGQgaW4gYWRkaXRpb25hbCBsb2NhdGlvbnMgdG8gdGhlIGNhY2hlcyBzbyB0aGF0IHRoZSByZXZlYWwgdHJhbnNhY3Rpb24gd2lsbCBwcm9wZXJseSBzdXJmYWNlIHRoZW1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWNvID0gRGVjb3JhdGlvbi5yZXBsYWNlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogdG9rZW4ubG9jXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hcmtlciA9IERlY29yYXRpb24ubWFyayh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNsdXNpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBPYmplY3QuZnJvbUVudHJpZXModG9rZW4uYXR0cmlidXRlcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2M6IHRva2VuLmxvY1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWNvLnJhbmdlKHRva2VuLmZyb20sIHRva2VuLnRvKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlci5yYW5nZSh0b2tlbi5sb2MuZnJvbSwgdG9rZW4ubG9jLnRvKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gRGVjb3JhdGlvbi5zZXQocmVwbGFjZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFzeW5jIHVwZGF0ZURlY29zKHRva2VuczogVG9rZW5TcGVjW10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXBsYWNlcnMgPSBhd2FpdCB0aGlzLmNvbXB1dGUodG9rZW5zKTtcbiAgICAgICAgICAgICAgICAvLyBpZiBvdXIgY29tcHV0ZSBmdW5jdGlvbiByZXR1cm5lZCBub3RoaW5nIGFuZCB0aGUgc3RhdGUgZmllbGQgc3RpbGwgaGFzIGRlY29yYXRpb25zLCBjbGVhciB0aGVtIG91dFxuICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlIHx8IHRoaXMuZWRpdG9yLnN0YXRlLmZpZWxkKGZpZWxkKS5zaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVmZmVjdHM6IFtyZXBsYWNlLm9mKHJlcGxhY2VycyA/PyBEZWNvcmF0aW9uLm5vbmUpXVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwbHVnaW4gPSBWaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICAgICAgICAgIGNsYXNzIHtcbiAgICAgICAgICAgICAgICBtYW5hZ2VyOiBTdGF0ZWZ1bERlY29yYXRpb25TZXQ7XG4gICAgICAgICAgICAgICAgc291cmNlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3Rvcih2aWV3OiBFZGl0b3JWaWV3KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlciA9IG5ldyBTdGF0ZWZ1bERlY29yYXRpb25TZXQodmlldyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGQodmlldyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdXBkYXRlKHVwZGF0ZTogVmlld1VwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTGl2ZVByZXZpZXcodXBkYXRlLnZpZXcuc3RhdGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZURlY29zKFtdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGUuZG9jQ2hhbmdlZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZSA9PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVpbGQodXBkYXRlLnZpZXcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGVzdHJveSgpIHt9XG5cbiAgICAgICAgICAgICAgICBidWlsZCh2aWV3OiBFZGl0b3JWaWV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNMaXZlUHJldmlldyh2aWV3LnN0YXRlKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRFbGVtZW50czogVG9rZW5TcGVjW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeyBmcm9tLCB0byB9IG9mIHZpZXcudmlzaWJsZVJhbmdlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJlZSA9IHN5bnRheFRyZWUodmlldy5zdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmVlLml0ZXJhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50ZXI6ICh7IG5vZGUsIGZyb20sIHRvIH0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IG5vZGUudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9rZW5Qcm9wcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlLnByb3A8c3RyaW5nPih0b2tlbkNsYXNzTm9kZVByb3ApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BzID0gbmV3IFNldCh0b2tlblByb3BzPy5zcGxpdChcIiBcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wcy5oYXMoXCJobWQtY29kZWJsb2NrXCIpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhcHJvcHMuaGFzKFwiZm9ybWF0dGluZy1jb2RlLWJsb2NrXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETzogWW91IHdpbGwgcHJvYmFibHkgbmVlZCB0byBpZGVudGlmeSBibG9jayB0eXBlcyB0byBkZXRlcm1pbmUgZnJvbSBhbmQgdG8gdmFsdWVzIHRvIGFwcGx5IG1hcmsuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghUHJvY2Vzc29yLkVORF9SRS50ZXN0KG9yaWdpbmFsKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBQcm9jZXNzb3IucGFyc2Uob3JpZ2luYWwpID8/IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiXHVEODNEXHVERTgwIH4gZmlsZTogbWFpbi50cyB+IGxpbmUgMjU0IH4gcGFyc2VkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcGFyc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGF0dHJpYnV0ZXMsIHRleHQgfSA9IGl0ZW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmluZGV4T2YodGV4dCkgKyB0ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gb3JpZ2luYWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudHJpbSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hdGNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYFxcXFx7XFxcXHM/JHt0ZXh0fVxccz9cXFxcfSRgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBmcm9tICsgbWF0Y2guaW5kZXggLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2guaW5kZXggK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFswXS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jOiB7IGZyb20sIHRvOiBmcm9tICsgZW5kIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG1hdGNoWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IG1hdGNoLmluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZURlY29zKHRhcmdldEVsZW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICAvLyBVdGlsaXR5IENvZGVcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGNvbnN0IHJlcGxhY2UgPSBTdGF0ZUVmZmVjdC5kZWZpbmU8RGVjb3JhdGlvblNldD4oKTtcbiAgICAgICAgY29uc3QgZmllbGQgPSBTdGF0ZUZpZWxkLmRlZmluZTxEZWNvcmF0aW9uU2V0Pih7XG4gICAgICAgICAgICBjcmVhdGUoKTogRGVjb3JhdGlvblNldCB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGUoZGVjbywgdHIpOiBEZWNvcmF0aW9uU2V0IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHIuZWZmZWN0cy5yZWR1Y2UoKGRlY28sIGVmZmVjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWZmZWN0LmlzKHJlcGxhY2UpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVmZmVjdC52YWx1ZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogKF8sIF9fLCBkZWNvcmF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhcmFuZ2VzSW5jbHVkZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyLm5ld1NlbGVjdGlvbi5yYW5nZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvcmF0aW9uLnNwZWMubG9jLmZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvcmF0aW9uLnNwZWMubG9jLnRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWNvO1xuICAgICAgICAgICAgICAgIH0sIGRlY28ubWFwKHRyLmNoYW5nZXMpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm92aWRlOiAoZmllbGQpID0+IEVkaXRvclZpZXcuZGVjb3JhdGlvbnMuZnJvbShmaWVsZClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIFtmaWVsZCwgcGx1Z2luXTtcbiAgICB9ICovXG59XG4iLCAiaW50ZXJmYWNlIEVsZW1lbnRXaXRoQXR0cmlidXRlcyB7XG4gICAgZWxlbWVudD86IEVsZW1lbnQ7XG4gICAgYXR0cmlidXRlczogW3N0cmluZywgc3RyaW5nXVtdO1xuICAgIHRleHQ6IHN0cmluZztcbiAgICAvKiByZXBsYWNlcjogKC4uLmFyZ3M6IGFueSkgPT4gdm9pZDsgKi9cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvY2Vzc29yIHtcbiAgICBzdGF0aWMgQkFTRV9SRSA9IC9cXHtcXDo/WyBdKihbXlxcfVxcbiBdW15cXH1cXG5dKilbIF0qXFx9LztcbiAgICBzdGF0aWMgT05MWV9SRSA9IC9eXFx7XFw6P1sgXSooW15cXH1cXG4gXVteXFx9XFxuXSopWyBdKlxcfSQvO1xuICAgIHN0YXRpYyBCTE9DS19SRSA9IC9cXG5bIF0qXFx7XFw6P1sgXSooW15cXH1cXG4gXVteXFx9XFxuXSopWyBdKlxcfVsgXSokLztcbiAgICBzdGF0aWMgRU5EX1JFID0gL1xce1xcOj9bIF0qKFteXFx9XFxuIF1bXlxcfVxcbl0qKVsgXSpcXH0kL207XG5cbiAgICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgICBzdGF0aWMgcGFyc2UoZWw6IEhUTUxFbGVtZW50KTogRWxlbWVudFdpdGhBdHRyaWJ1dGVzW107XG4gICAgc3RhdGljIHBhcnNlKGVsOiBzdHJpbmcpOiBFbGVtZW50V2l0aEF0dHJpYnV0ZXNbXTtcbiAgICBzdGF0aWMgcGFyc2UoZWw6IHN0cmluZyB8IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGlmICh0eXBlb2YgZWwgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9jZXNzb3IoKS5wYXJzZUxpbmUoZWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9jZXNzb3IoKS5yZWN1cnNlQW5kUGFyc2VFbGVtZW50cyhlbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGFyc2VMaW5lKHRleHQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBlbGVtZW50czogRWxlbWVudFdpdGhBdHRyaWJ1dGVzW10gPSBbXTtcbiAgICAgICAgLy8gUGFyc2Ugb3V0IHRoZSBhdHRyaWJ1dGUgc3RyaW5nLlxuICAgICAgICBsZXQgYXR0cmlidXRlX3N0cmluZ3MgPSB0ZXh0Lm1hdGNoQWxsKFxuICAgICAgICAgICAgbmV3IFJlZ0V4cChQcm9jZXNzb3IuRU5EX1JFLnNvdXJjZSwgXCJnbVwiKVxuICAgICAgICApO1xuXG4gICAgICAgIGZvciAoY29uc3QgW18sIG1hdGNoXSBvZiBhdHRyaWJ1dGVfc3RyaW5ncykge1xuICAgICAgICAgICAgZWxlbWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogdGhpcy5nZXRBdHRycyhtYXRjaCksXG4gICAgICAgICAgICAgICAgdGV4dDogbWF0Y2hcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbGVtZW50cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmF2ZXJzZXMgYW4gZWxlbWVudHMgY2hpbGQgbm9kZXMgYW5kIHJldHVybnMgdGhlIHRleHQgY29udGVudC5cbiAgICAgKiBAcGFyYW0gZWwgSFRNTCBlbGVtZW50IHRvIGdldCB0ZXh0IG5vZGVzIG9mLlxuICAgICAqIEByZXR1cm5zIFRvcCBsZXZlbCB0ZXh0IG9mIHRoZSBlbGVtZW50LlxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0VG9wTGV2ZWxUZXh0KGVsOiBFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHRleHRzID0gW107XG5cbiAgICAgICAgZm9yIChsZXQgY2hpbGQgb2YgQXJyYXkuZnJvbShlbC5jaGlsZE5vZGVzKSkge1xuICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IE5vZGUuVEVYVF9OT0RFKSB7XG4gICAgICAgICAgICAgICAgdGV4dHMucHVzaCgoY2hpbGQgYXMgQ2hhcmFjdGVyRGF0YSkuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGV4dHMuam9pbihcIlwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZSBhIHN0cmluZyBhbmQgcmV0dXJuIHRoZSBba2V5LCB2YWx1ZV0gYXR0cmlidXRlIHBhaXJzLlxuICAgICAqIEBwYXJhbSBzdHIgU3RyaW5nIHRvIHB1bGwgYXR0cmlidXRlcyBmcm9tLlxuICAgICAqIEByZXR1cm5zIHtbc3RyaW5nLCBzdHJpbmddfSBBcnJheSBvZiBba2V5LCB2YWx1ZV0gYXR0cmlidXRlIHBhaXJzLlxuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0QXR0cnMoc3RyOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgdHJ5cyA9IChzdHIgPz8gXCJcIilcbiAgICAgICAgICAgIC8vIFNwbGl0IHRoZSBzdHJpbmcgYXQgc3BhY2VzIHRoYXQgYXJlICpub3QqIGJldHdlZW4gcXVvdGVzLlxuICAgICAgICAgICAgLnNwbGl0KC9cXHMoPz0oPzpbXidcImBdKihbJ1wiYF0pW14nXCJgXSpcXDEpKlteJ1wiYF0qJCkvKVxuICAgICAgICAgICAgLy8gVHJpbSB0aGUgcmVzdWx0aW5nIHN0cmluZ3MuXG4gICAgICAgICAgICAubWFwKCh0KSA9PiB0ICYmIHQudHJpbSgpKVxuICAgICAgICAgICAgLy8gUmVtb3ZlIGFueSBzdHJpbmdzIHRoYXQgYXJlIHVuZGVmaW5lZCwgemVybyBsZW5ndGgsIG9yIGp1c3QgYSBxdW90ZSBjaGFyYWN0ZXIuXG4gICAgICAgICAgICAuZmlsdGVyKCh0KSA9PiB0ICYmIHQgIT09ICdcIicgJiYgdCAhPT0gXCInXCIgJiYgdC5sZW5ndGgpO1xuXG4gICAgICAgIGlmICghdHJ5cyB8fCAhdHJ5cy5sZW5ndGgpIHJldHVybjtcblxuICAgICAgICAvLyBUaGVzZSBjaGFyYWN0ZXJzIGFyZSBub3QgYWxsb3dlZCB0byBiZSBpbnNpZGUgYW4gYXR0cmlidXRlIGtleS5cbiAgICAgICAgY29uc3QgYWxsb3dlZEtleUNoYXJzID0gL1teXFx0XFxuXFxmIC8+XCInPV0vO1xuXG4gICAgICAgIC8vIHs6IGRhdGE9dmFsdWUgfVxuICAgICAgICBjb25zdCBrZXlTZXBhcmF0b3IgPSBcIj1cIjtcbiAgICAgICAgLy8geyAuY2xhc3MgfVxuICAgICAgICBjb25zdCBjbGFzc0NoYXIgPSBcIi5cIjtcbiAgICAgICAgLy8geyAjaWQgfVxuICAgICAgICAvLyBjdXJyZW50bHkgbm90IGFsbG93ZWQgZHVlIHRvIE9ic2lkaWFuIHRhZ1xuICAgICAgICAvLyBUT0RPOiBGaWd1cmUgb3V0IGEgd29ya2Fyb3VuZC5cbiAgICAgICAgLyogY29uc3QgaWRDaGFyID0gXCIjXCI7ICovXG4gICAgICAgIGNvbnN0IGF0dHJzOiBBcnJheTxbc3RyaW5nLCBzdHJpbmddPiA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IHBhaXIgb2YgdHJ5cykge1xuICAgICAgICAgICAgaWYgKCFwYWlyIHx8ICFwYWlyLmxlbmd0aCkgY29udGludWU7XG5cbiAgICAgICAgICAgIC8vI2lkXG4gICAgICAgICAgICAvKiBpZiAocGFpci5jaGFyQXQoMCkgPT09IGlkQ2hhcikge1xuICAgICAgICAgICAgICAgIGF0dHJzLnB1c2goW1wiaWRcIiwgcGFpci5zbGljZSgxKV0pO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfSAqL1xuXG4gICAgICAgICAgICAvLyAuY2xhc3NcbiAgICAgICAgICAgIGlmIChwYWlyLmNoYXJBdCgwKSA9PT0gY2xhc3NDaGFyKSB7XG4gICAgICAgICAgICAgICAgYXR0cnMucHVzaChbXCJjbGFzc1wiLCBwYWlyLnNsaWNlKDEpXSk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGRhdGE9dmFsdWVcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKGtleVNlcGFyYXRvcikudGVzdChwYWlyKSAmJlxuICAgICAgICAgICAgICAgIGFsbG93ZWRLZXlDaGFycy50ZXN0KHBhaXIuc2xpY2UoMCwgcGFpci5pbmRleE9mKGtleVNlcGFyYXRvcikpKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgYXR0cnMucHVzaChbLi4ucGFpci5zcGxpdChrZXlTZXBhcmF0b3IsIDIpXSBhcyBbXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGNoZWNrZWRcbiAgICAgICAgICAgIGF0dHJzLnB1c2goW3BhaXIsIG51bGxdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXR0cnM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZWwgSFRNTCBlbGVtZW50IHRvIHBhcnNlLlxuICAgICAqIEByZXR1cm5zIHtFbGVtZW50V2l0aEF0dHJpYnV0ZXN9IEVsZW1lbnQsIGF0dHJpYnV0ZXMgdG8gYXBwbHksIG9yaWdpbmFsIG1hdGNoZWQgdGV4dC5cbiAgICAgKi9cbiAgICBwcml2YXRlIHJlY3Vyc2VBbmRQYXJzZUVsZW1lbnRzKGVsOiBIVE1MRWxlbWVudCk6IEVsZW1lbnRXaXRoQXR0cmlidXRlc1tdIHtcbiAgICAgICAgY29uc3QgZWxlbWVudHM6IEVsZW1lbnRXaXRoQXR0cmlidXRlc1tdID0gW107XG5cbiAgICAgICAgLy8gVGV4dCBjb250ZW50IG9mIHRoaXMgbm9kZSBhbmQgKm5vdCogdGhlIGNoaWxkcmVuLlxuICAgICAgICBjb25zdCB0ZXh0ID0gdGhpcy5nZXRUb3BMZXZlbFRleHQoZWwpO1xuXG4gICAgICAgIGlmIChQcm9jZXNzb3IuQkxPQ0tfUkUudGVzdCh0ZXh0KSkge1xuICAgICAgICAgICAgLy8gQXR0cmlidXRlcyBzaG91bGQgYXBwbHkgdG8gdGhlIHdob2xlIGJsb2NrLlxuXG4gICAgICAgICAgICBsZXQgZWxlbWVudCA9IGVsO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGVsIGluc3RhbmNlb2YgSFRNTExJRWxlbWVudCB8fFxuICAgICAgICAgICAgICAgIGVsPy5wYXJlbnRFbGVtZW50IGluc3RhbmNlb2YgSFRNTFF1b3RlRWxlbWVudCB8fFxuICAgICAgICAgICAgICAgIGVsPy5oYXNDbGFzcyhcImNhbGxvdXRcIilcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gYXBwbHkgYXR0cmlidXRlcyB0byBjb250YWluaW5nIFVMIGlmIEhUTUxMSUVsZW1lbnQgaGFzIGEgYmxvY2sgYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBbb3JpZ2luYWwsIGF0dHJpYnV0ZV9zdHJpbmddID1cbiAgICAgICAgICAgICAgICB0ZXh0Lm1hdGNoKFByb2Nlc3Nvci5CTE9DS19SRSkgPz8gW107XG4gICAgICAgICAgICBjb25zdCB0b0FkZCA9IHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRoaXMuZ2V0QXR0cnMoYXR0cmlidXRlX3N0cmluZyksXG4gICAgICAgICAgICAgICAgdGV4dDogYXR0cmlidXRlX3N0cmluZ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZWxlbWVudHMucHVzaCh0b0FkZCk7XG4gICAgICAgICAgICBlbC5pbm5lckhUTUwgPSB0aGlzLnRyeVRvUmVwbGFjZShcbiAgICAgICAgICAgICAgICB0b0FkZC5lbGVtZW50LFxuICAgICAgICAgICAgICAgIGVsLmlubmVySFRNTCxcbiAgICAgICAgICAgICAgICB0b0FkZC5hdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLyogZWwuaW5uZXJIVE1MID0gZWwuaW5uZXJIVE1MLnJlcGxhY2Uob3JpZ2luYWwsIFwiXCIpOyAqL1xuXG4gICAgICAgICAgICAvL3JlcnVuIHBhcnNlciBpZiBMSSBlbGVtZW50IHRvIGdldCBpbmxpbmVzXG4gICAgICAgICAgICBpZiAoZWwgaW5zdGFuY2VvZiBIVE1MTElFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCguLi50aGlzLnJlY3Vyc2VBbmRQYXJzZUVsZW1lbnRzKGVsKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoUHJvY2Vzc29yLkJBU0VfUkUudGVzdCh0ZXh0KSkge1xuICAgICAgICAgICAgLy8gQXR0cmlidXRlcyBhcmUgaW5saW5lLlxuICAgICAgICAgICAgLy8gR2V0IHRoZSB0ZXh0IG5vZGVzIHRoYXQgY29udGFpbnMgdGhlIGF0dHJpYnV0ZSBzdHJpbmcuXG4gICAgICAgICAgICBsZXQgdGV4dE5vZGUgPSBBcnJheS5mcm9tKGVsLmNoaWxkTm9kZXMpLmZpbmQoXG4gICAgICAgICAgICAgICAgKG5vZGUpID0+XG4gICAgICAgICAgICAgICAgICAgIG5vZGUubm9kZVR5cGUgPT0gTm9kZS5URVhUX05PREUgJiZcbiAgICAgICAgICAgICAgICAgICAgUHJvY2Vzc29yLkJBU0VfUkUudGVzdCh0ZXh0KVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gRmluZCB0aGUgSFRNTCBlbGVtZW50IHRoYXQgaXMgdGhlIHByZXZpb3VzIHNpYmxpbmcgb2YgdGhlIHRleHQgbm9kZS5cbiAgICAgICAgICAgIC8vIHRleHROb2RlLnByZXZpb3VzU2libGluZyBjb3VsZCByZXR1cm4gYW5vdGhlciB0ZXh0IG5vZGUuXG4gICAgICAgICAgICAvLyBwcmV2aW91c0VsZW1lbnRTaWJsaW5nIGRvZXMgbm90IGV4aXN0aW5nIG9uIGEgdGV4dCBub2RlLlxuICAgICAgICAgICAgbGV0IHNpYmxpbmcgPVxuICAgICAgICAgICAgICAgIEFycmF5LmZyb20oZWwuY2hpbGRyZW4pLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgIChub2RlKSA9PiBub2RlLm5leHRTaWJsaW5nID09IHRleHROb2RlXG4gICAgICAgICAgICAgICAgKSA/PyBlbDtcblxuICAgICAgICAgICAgLy8gQ29sbGFwc2libGUgZWxlbWVudHMgYXJlIGEgc3BlY2lhbCBjYXNlIGR1ZSB0byB0aGUgY29sbGFwc2UgaGFuZGxlLlxuICAgICAgICAgICAgaWYgKHNpYmxpbmcgJiYgc2libGluZy5oYXNDbGFzcyhcImNvbGxhcHNlLWluZGljYXRvclwiKSkge1xuICAgICAgICAgICAgICAgIHNpYmxpbmcgPSBzaWJsaW5nLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzaWJsaW5nICYmIHNpYmxpbmcgaW5zdGFuY2VvZiBIVE1MQlJFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgc2libGluZyA9IHNpYmxpbmcucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUGFyc2Ugb3V0IHRoZSBhdHRyaWJ1dGUgc3RyaW5nLlxuICAgICAgICAgICAgbGV0IFtvcmlnaW5hbCwgYXR0cmlidXRlX3N0cmluZ10gPVxuICAgICAgICAgICAgICAgIHRleHQubWF0Y2goUHJvY2Vzc29yLkJBU0VfUkUpID8/IFtdO1xuXG4gICAgICAgICAgICBjb25zdCB0b0FkZCA9IHtcbiAgICAgICAgICAgICAgICBlbGVtZW50OiBzaWJsaW5nLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRoaXMuZ2V0QXR0cnMoYXR0cmlidXRlX3N0cmluZyksXG4gICAgICAgICAgICAgICAgdGV4dDogYXR0cmlidXRlX3N0cmluZ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZWxlbWVudHMucHVzaCh0b0FkZCk7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgb3JpZ2luYWwgYXR0cmlidXRlIHN0cmluZyBmcm9tIHRoZSB0ZXh0IGNvbnRlbnQuXG4gICAgICAgICAgICB0ZXh0Tm9kZS50ZXh0Q29udGVudCA9IHRoaXMudHJ5VG9SZXBsYWNlKFxuICAgICAgICAgICAgICAgIHRvQWRkLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdGV4dE5vZGUudGV4dENvbnRlbnQsXG4gICAgICAgICAgICAgICAgdG9BZGQuYXR0cmlidXRlcyxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIC8qIHRleHROb2RlLnRleHRDb250ZW50ID0gdGV4dE5vZGUudGV4dENvbnRlbnQucmVwbGFjZShvcmlnaW5hbCwgXCJcIik7ICovXG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZWN1cnNpdmVseSBmaW5kIGFsbCBhdHRyaWJ1dGVzIGZyb20gdGhlIGNoaWxkcmVuIG9mIHRoaXMgZWxlbWVudC5cblxuICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiBBcnJheS5mcm9tKGVsLmNoaWxkcmVuKSkge1xuICAgICAgICAgICAgaWYgKCEoY2hpbGQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGNoaWxkIGluc3RhbmNlb2YgSFRNTFByZUVsZW1lbnQgfHxcbiAgICAgICAgICAgICAgICBjaGlsZC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiY29kZVwiXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBlbGVtZW50cy5wdXNoKC4uLnRoaXMucmVjdXJzZUFuZFBhcnNlRWxlbWVudHMoY2hpbGQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbGVtZW50cztcbiAgICB9XG4gICAgdHJ5VG9SZXBsYWNlKFxuICAgICAgICBlbGVtZW50OiBFbGVtZW50LFxuICAgICAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgICAgIGF0dHJpYnV0ZXM6IFtzdHJpbmcsIHN0cmluZ11bXSxcbiAgICAgICAgb3JpZ2luYWw6IHN0cmluZ1xuICAgICkge1xuICAgICAgICBpZiAoIWF0dHJpYnV0ZXMgfHwgIWF0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IFtrZXksIHZhbHVlXSBvZiBhdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICBpZiAoIWtleSkgY29udGludWU7XG4gICAgICAgICAgICBpZiAodmFsdWUpIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvKFwifCcpL2csIFwiXCIpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBcImNsYXNzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzc2VzKHZhbHVlLnNwbGl0KFwiIFwiKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyKGtleSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgYE1hcmtkb3duIEF0dHJpYnV0ZXM6ICR7a2V5fSBpcyBub3QgYSB2YWxpZCBhdHRyaWJ1dGUuYFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udGVudC5yZXBsYWNlKG9yaWdpbmFsLCBcIlwiKTtcbiAgICB9XG59XG4iLCAiLypcbiAqIGluc3BpcmVkIGFuZCBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2JsYWNrc21pdGhndS9vYnNpZGlhbi1kYXRhdmlldy9ibG9iL21hc3Rlci9zcmMvbWFpbi50c1xuICpcbiAqIFRoZSBvcmlnaW5hbCB3b3JrIGlzIE1JVC1saWNlbnNlZC5cbiAqXG4gKiBNSVQgTGljZW5zZVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAyMiBhcnRpc3RpY2F0MVxuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKlxuICogKi9cblxuaW1wb3J0IHtcbiAgICBEZWNvcmF0aW9uLFxuICAgIERlY29yYXRpb25TZXQsXG4gICAgRWRpdG9yVmlldyxcbiAgICBWaWV3UGx1Z2luLFxuICAgIFZpZXdVcGRhdGUsXG4gICAgV2lkZ2V0VHlwZVxufSBmcm9tIFwiQGNvZGVtaXJyb3Ivdmlld1wiO1xuaW1wb3J0IHsgRWRpdG9yU2VsZWN0aW9uLCBSYW5nZSB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHsgc3ludGF4VHJlZSB9IGZyb20gXCJAY29kZW1pcnJvci9sYW5ndWFnZVwiO1xuaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgZWRpdG9yRWRpdG9yRmllbGQsXG4gICAgZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCxcbiAgICBlZGl0b3JWaWV3RmllbGRcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgUHJvY2Vzc29yIGZyb20gXCIuL3Byb2Nlc3NvclwiO1xuXG5mdW5jdGlvbiBzZWxlY3Rpb25BbmRSYW5nZU92ZXJsYXAoXG4gICAgc2VsZWN0aW9uOiBFZGl0b3JTZWxlY3Rpb24sXG4gICAgcmFuZ2VGcm9tOiBudW1iZXIsXG4gICAgcmFuZ2VUbzogbnVtYmVyXG4pIHtcbiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHNlbGVjdGlvbi5yYW5nZXMpIHtcbiAgICAgICAgaWYgKHJhbmdlLmZyb20gPD0gcmFuZ2VUbyAmJiByYW5nZS50byA+PSByYW5nZUZyb20pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5jbGFzcyBJbmxpbmVXaWRnZXQgZXh0ZW5kcyBXaWRnZXRUeXBlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcmVhZG9ubHkgY3NzQ2xhc3Nlczogc3RyaW5nW10sXG4gICAgICAgIHJlYWRvbmx5IHJhd1F1ZXJ5OiBzdHJpbmcsXG4gICAgICAgIHByaXZhdGUgZWw6IEhUTUxFbGVtZW50LFxuICAgICAgICBwcml2YXRlIHZpZXc6IEVkaXRvclZpZXdcbiAgICApIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICAvLyBXaWRnZXRzIG9ubHkgZ2V0IHVwZGF0ZWQgd2hlbiB0aGUgcmF3IHF1ZXJ5IGNoYW5nZXMvdGhlIGVsZW1lbnQgZ2V0cyBmb2N1cyBhbmQgbG9zZXMgaXRcbiAgICAvLyB0byBwcmV2ZW50IHJlZHJhd3Mgd2hlbiB0aGUgZWRpdG9yIHVwZGF0ZXMuXG4gICAgZXEob3RoZXI6IElubGluZVdpZGdldCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAob3RoZXIucmF3UXVlcnkgPT09IHRoaXMucmF3UXVlcnkpIHtcbiAgICAgICAgICAgIC8vIGNoYW5nZSBDU1MgY2xhc3NlcyB3aXRob3V0IHJlZHJhd2luZyB0aGUgZWxlbWVudFxuICAgICAgICAgICAgZm9yIChsZXQgdmFsdWUgb2Ygb3RoZXIuY3NzQ2xhc3Nlcykge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jc3NDbGFzc2VzLmluY2x1ZGVzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsLnJlbW92ZUNsYXNzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVsLmFkZENsYXNzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQWRkIENTUyBjbGFzc2VzIGFuZCByZXR1cm4gSFRNTCBlbGVtZW50LlxuICAgIC8vIEluIFwiY29tcGxleFwiIGNhc2VzIGl0IHdpbGwgZ2V0IGZpbGxlZCB3aXRoIHRoZSBjb3JyZWN0IHRleHQvY2hpbGQgZWxlbWVudHMgbGF0ZXIuXG4gICAgdG9ET00odmlldzogRWRpdG9yVmlldyk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgdGhpcy5lbC5hZGRDbGFzc2VzKHRoaXMuY3NzQ2xhc3Nlcyk7XG4gICAgICAgIHJldHVybiB0aGlzLmVsO1xuICAgIH1cblxuICAgIC8qIE1ha2UgcXVlcmllcyBvbmx5IGVkaXRhYmxlIHdoZW4gc2hpZnQgaXMgcHJlc3NlZCAob3IgbmF2aWdhdGVkIGluc2lkZSB3aXRoIHRoZSBrZXlib2FyZFxuICAgICAqIG9yIHRoZSBtb3VzZSBpcyBwbGFjZWQgYXQgdGhlIGVuZCwgYnV0IHRoYXQgaXMgYWx3YXlzIHBvc3NpYmxlIHJlZ2FyZGxlc3Mgb2YgdGhpcyBtZXRob2QpLlxuICAgICAqIE1vc3RseSB1c2VmdWwgZm9yIGxpbmtzLCBhbmQgbWFrZXMgcmVzdWx0cyBzZWxlY3RhYmxlLlxuICAgICAqIElmIHRoZSB3aWRnZXRzIHNob3VsZCBhbHdheXMgYmUgZXhwYW5kYWJsZSwgbWFrZSB0aGlzIGFsd2F5cyByZXR1cm4gZmFsc2UuXG4gICAgICovXG4gICAgaWdub3JlRXZlbnQoZXZlbnQ6IE1vdXNlRXZlbnQgfCBFdmVudCk6IGJvb2xlYW4ge1xuICAgICAgICAvLyBpbnN0YW5jZW9mIGNoZWNrIGRvZXMgbm90IHdvcmsgaW4gcG9wLW91dCB3aW5kb3dzLCBzbyBjaGVjayBpdCBsaWtlIHRoaXNcbiAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IFwibW91c2Vkb3duXCIpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQb3MgPSB0aGlzLnZpZXcucG9zQXRDb29yZHMoe1xuICAgICAgICAgICAgICAgIHg6IChldmVudCBhcyBNb3VzZUV2ZW50KS54LFxuICAgICAgICAgICAgICAgIHk6IChldmVudCBhcyBNb3VzZUV2ZW50KS55XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICgoZXZlbnQgYXMgTW91c2VFdmVudCkuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGN1cnNvciBhZnRlciB0aGUgZWxlbWVudCBzbyB0aGF0IGl0IGRvZXNuJ3Qgc2VsZWN0IHN0YXJ0aW5nIGZyb20gdGhlIGxhc3QgY3Vyc29yIHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGVkaXRvciB9ID0gdGhpcy52aWV3LnN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmllbGQoZWRpdG9yRWRpdG9yRmllbGQpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3RhdGUuZmllbGQoZWRpdG9yVmlld0ZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldEN1cnNvcihlZGl0b3Iub2Zmc2V0VG9Qb3MoY3VycmVudFBvcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRDc3NDbGFzc2VzKG5vZGVOYW1lOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY2xhc3Nlczogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAobm9kZU5hbWUuaW5jbHVkZXMoXCJzdHJvbmdcIikpIHtcbiAgICAgICAgY2xhc3Nlcy5wdXNoKFwiY20tc3Ryb25nXCIpO1xuICAgIH1cbiAgICBpZiAobm9kZU5hbWUuaW5jbHVkZXMoXCJlbVwiKSkge1xuICAgICAgICBjbGFzc2VzLnB1c2goXCJjbS1lbVwiKTtcbiAgICB9XG4gICAgaWYgKG5vZGVOYW1lLmluY2x1ZGVzKFwiaGlnaGxpZ2h0XCIpKSB7XG4gICAgICAgIGNsYXNzZXMucHVzaChcImNtLWhpZ2hsaWdodFwiKTtcbiAgICB9XG4gICAgaWYgKG5vZGVOYW1lLmluY2x1ZGVzKFwic3RyaWtldGhyb3VnaFwiKSkge1xuICAgICAgICBjbGFzc2VzLnB1c2goXCJjbS1zdHJpa2V0aHJvdWdoXCIpO1xuICAgIH1cbiAgICBpZiAobm9kZU5hbWUuaW5jbHVkZXMoXCJjb21tZW50XCIpKSB7XG4gICAgICAgIGNsYXNzZXMucHVzaChcImNtLWNvbW1lbnRcIik7XG4gICAgfVxuICAgIHJldHVybiBjbGFzc2VzO1xufVxuXG5mdW5jdGlvbiBpbmxpbmVSZW5kZXIodmlldzogRWRpdG9yVmlldykge1xuICAgIC8vIHN0aWxsIGRvZXNuJ3Qgd29yayBhcyBleHBlY3RlZCBmb3IgdGFibGVzIGFuZCBjYWxsb3V0c1xuXG4gICAgY29uc3QgY3VycmVudEZpbGUgPSBhcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICBpZiAoIWN1cnJlbnRGaWxlKSByZXR1cm47XG5cbiAgICBjb25zdCB3aWRnZXRzOiBSYW5nZTxEZWNvcmF0aW9uPltdID0gW107XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gdmlldy5zdGF0ZS5zZWxlY3Rpb247XG4gICAgLyogYmVmb3JlOlxuICAgICAqICAgICBlbSBmb3IgaXRhbGljc1xuICAgICAqICAgICBoaWdobGlnaHQgZm9yIGhpZ2hsaWdodFxuICAgICAqIGFmdGVyOlxuICAgICAqICAgICBzdHJvbmcgZm9yIGJvbGRcbiAgICAgKiAgICAgc3RyaWtldGhyb3VnaCBmb3Igc3RyaWtldGhyb3VnaFxuICAgICAqL1xuXG4gICAgZm9yIChjb25zdCB7IGZyb20sIHRvIH0gb2Ygdmlldy52aXNpYmxlUmFuZ2VzKSB7XG4gICAgICAgIHN5bnRheFRyZWUodmlldy5zdGF0ZSkuaXRlcmF0ZSh7XG4gICAgICAgICAgICBmcm9tLFxuICAgICAgICAgICAgdG8sXG4gICAgICAgICAgICBlbnRlcjogKHsgbm9kZSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IG5vZGUudHlwZTtcbiAgICAgICAgICAgICAgICAvLyBtYXJrZG93biBmb3JtYXR0aW5nIHN5bWJvbHNcbiAgICAgICAgICAgICAgICBpZiAodHlwZS5uYW1lLmluY2x1ZGVzKFwiZm9ybWF0dGluZ1wiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgLy8gY29udGFpbnMgdGhlIHBvc2l0aW9uIG9mIG5vZGVcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydCA9IG5vZGUuZnJvbTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbmQgPSBub2RlLnRvO1xuICAgICAgICAgICAgICAgIC8vIGRvbid0IGNvbnRpbnVlIGlmIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIGFuZCBpbmxpbmUgY29kZSBub2RlIChpbmNsdWRpbmcgZm9ybWF0dGluZ1xuICAgICAgICAgICAgICAgIC8vIHN5bWJvbHMpIG92ZXJsYXBcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0aW9uQW5kUmFuZ2VPdmVybGFwKHNlbGVjdGlvbiwgc3RhcnQgLSAxLCBlbmQgKyAxKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhzdGFydCwgZW5kKTtcbiAgICAgICAgICAgICAgICBpZiAoIVByb2Nlc3Nvci5FTkRfUkUudGVzdChvcmlnaW5hbCkpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGxldCBjb2RlOiBzdHJpbmcgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gY3JlYXRlU3Bhbih7XG4gICAgICAgICAgICAgICAgICAgIGNsczogW1wiZGF0YXZpZXdcIiwgXCJkYXRhdmlldy1pbmxpbmVcIl1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvKiBJZiB0aGUgcXVlcnkgcmVzdWx0IGlzIHByZWRlZmluZWQgdGV4dCAoZS5nLiBpbiB0aGUgY2FzZSBvZiBlcnJvcnMpLCBzZXQgaW5uZXJUZXh0IHRvIGl0LlxuICAgICAgICAgICAgICAgICAqIE90aGVyd2lzZSwgcGFzcyBvbiBhbiBlbXB0eSBlbGVtZW50IGFuZCBmaWxsIGl0IGluIGxhdGVyLlxuICAgICAgICAgICAgICAgICAqIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2Uge0BsaW5rIElubGluZVdpZGdldC50b0RPTX0gaXMgc3luY2hyb25vdXMgYnV0IHNvbWUgcmVuZGVyaW5nXG4gICAgICAgICAgICAgICAgICogYXN5bmNocm9ub3VzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGNvZGUgPSBvcmlnaW5hbC50cmltKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gUHJvY2Vzc29yLnBhcnNlKG9yaWdpbmFsKSA/PyBbXTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgXCJcdUQ4M0RcdURFODAgfiBmaWxlOiBsaXZlLXByZXZpZXcudHMgfiBsaW5lIDE5MSB+IHBhcnNlZFwiLFxuICAgICAgICAgICAgICAgICAgICBwYXJzZWRcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHBhcnNlZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGF0dHJpYnV0ZXMsIHRleHQgfSA9IGl0ZW07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0QnJhY2tldCA9IG9yaWdpbmFsXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgb3JpZ2luYWwuaW5kZXhPZih0ZXh0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5sYXN0SW5kZXhPZihcIntcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdEJyYWNrZXQgPSBvcmlnaW5hbC5pbmRleE9mKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ9XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5pbmRleE9mKHRleHQpXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xhc3NlcyA9IGdldENzc0NsYXNzZXModHlwZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgLyogcmV0dXJuOyAqL1xuICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICBEZWNvcmF0aW9uLnJlcGxhY2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldDogbmV3IElubGluZVdpZGdldChjbGFzc2VzLCBjb2RlLCBlbCwgdmlldyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnJhbmdlKHN0YXJ0ICsgZmlyc3RCcmFja2V0LCBzdGFydCArIGxhc3RCcmFja2V0ICsgMSksXG4gICAgICAgICAgICAgICAgICAgICAgICBEZWNvcmF0aW9uLm1hcmsoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBPYmplY3QuZnJvbUVudHJpZXMoYXR0cmlidXRlcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnJhbmdlKGZyb20sIHRvKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIERlY29yYXRpb24uc2V0KHdpZGdldHMsIHRydWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5saW5lUGx1Z2luKCkge1xuICAgIHJldHVybiBWaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICAgICAgY2xhc3Mge1xuICAgICAgICAgICAgZGVjb3JhdGlvbnM6IERlY29yYXRpb25TZXQ7XG5cbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKHZpZXc6IEVkaXRvclZpZXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gaW5saW5lUmVuZGVyKHZpZXcpID8/IERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXBkYXRlKHVwZGF0ZTogVmlld1VwZGF0ZSkge1xuICAgICAgICAgICAgICAgIC8vIG9ubHkgYWN0aXZhdGUgaW4gTFAgYW5kIG5vdCBzb3VyY2UgbW9kZVxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGlmICghdXBkYXRlLnN0YXRlLmZpZWxkKGVkaXRvckxpdmVQcmV2aWV3RmllbGQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGUuZG9jQ2hhbmdlZCB8fFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGUudmlld3BvcnRDaGFuZ2VkIHx8XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZS5zZWxlY3Rpb25TZXRcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmxpbmVSZW5kZXIodXBkYXRlLnZpZXcpID8/IERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHsgZGVjb3JhdGlvbnM6ICh2KSA9PiB2LmRlY29yYXRpb25zIH1cbiAgICApO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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
